# SVOTC Lovelace Dashboard Cards

## Komplett Dashboard - Allt på en sida

```yaml
title: SVOTC Kontrollpanel
path: svotc
icon: mdi:thermostat
badges: []
cards:
  # ============================================
  # HUVUDKONTROLL - Överst
  # ============================================
  - type: vertical-stack
    cards:
      # Status Overview Card
      - type: custom:mushroom-template-card
        primary: SVOTC Status
        secondary: "{{ states('sensor.svotc_status') }}"
        icon: |-
          {% set reason = states('input_text.svotc_reason_code') %}
          {% if reason == 'OFF' %} mdi:power-off
          {% elif reason == 'PRICE_BRAKE' %} mdi:snowflake-alert
          {% elif reason == 'MCP' %} mdi:brain
          {% elif reason == 'COMFORT_GUARD' %} mdi:shield-home
          {% elif reason == 'SAFE_MODE' %} mdi:alert
          {% else %} mdi:home-thermometer
          {% endif %}
        icon_color: |-
          {% set reason = states('input_text.svotc_reason_code') %}
          {% if reason == 'OFF' %} grey
          {% elif reason == 'PRICE_BRAKE' %} blue
          {% elif reason == 'MCP' %} green
          {% elif reason == 'COMFORT_GUARD' %} orange
          {% elif reason == 'SAFE_MODE' %} red
          {% else %} grey
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.svotc_status
        badge_icon: |-
          {% if is_state('binary_sensor.svotc_sensors_healthy', 'off') %}
          mdi:alert-circle
          {% endif %}
        badge_color: red

      # Mode Selector
      - type: custom:mushroom-select-card
        entity: input_select.svotc_mode
        icon: mdi:playlist-edit
        fill_container: false

  # ============================================
  # TEMPERATUR OCH PRISER - Rad 2
  # ============================================
  - type: horizontal-stack
    cards:
      # Indoor Temperature
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_src_indoor
        name: Inomhus
        icon: mdi:home-thermometer
        icon_color: red
        primary_info: state
        secondary_info: name

      # Target Temperature
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_dynamic_target_temperature
        name: Mål
        icon: mdi:target
        icon_color: orange
        primary_info: state
        secondary_info: name

      # Outdoor Temperature
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_src_outdoor
        name: Utomhus
        icon: mdi:thermometer
        icon_color: blue
        primary_info: state
        secondary_info: name

  # Current Price Bar
  - type: horizontal-stack
    cards:
      # Current Price
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_current_price
        name: Elpris nu
        icon: mdi:lightning-bolt
        icon_color: |-
          {% set price = states('sensor.svotc_current_price') | float(0) %}
          {% set p30 = states('sensor.svotc_p30') | float(0) %}
          {% set p80 = states('sensor.svotc_p80') | float(0) %}
          {% if price > p80 %} red
          {% elif price < p30 %} green
          {% else %} orange
          {% endif %}

      # P30 Threshold
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_p30
        name: P30 (billigt)
        icon: mdi:arrow-down-bold
        icon_color: green

      # P80 Threshold  
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_p80
        name: P80 (dyrt)
        icon: mdi:arrow-up-bold
        icon_color: red

  # ============================================
  # OFFSET KONTROLL - Visuell representation
  # ============================================
  - type: custom:mushroom-template-card
    primary: Offset Kontroll
    secondary: |-
      Begärd: {{ states('input_number.svotc_requested_offset_c') }}°C | 
      Applicerad: {{ states('input_number.svotc_applied_offset_c') }}°C
    icon: mdi:thermometer-lines
    icon_color: |-
      {% set offset = states('input_number.svotc_applied_offset_c') | float(0) %}
      {% if offset > 2 %} red
      {% elif offset < -2 %} blue
      {% else %} grey
      {% endif %}
    badge_icon: |-
      {% set phase = states('input_text.svotc_brake_phase') %}
      {% if phase == 'ramping_up' %} mdi:arrow-up-thick
      {% elif phase == 'ramping_down' %} mdi:arrow-down-thick
      {% elif phase == 'holding' %} mdi:hand-back-right
      {% endif %}
    badge_color: |-
      {% set phase = states('input_text.svotc_brake_phase') %}
      {% if phase == 'ramping_up' %} blue
      {% elif phase == 'ramping_down' %} orange
      {% elif phase == 'holding' %} blue
      {% else %} grey
      {% endif %}

  # Offset Gauge
  - type: gauge
    entity: input_number.svotc_applied_offset_c
    name: Applicerad Offset
    min: -10
    max: 10
    severity:
      green: -2
      yellow: 2
      red: 5
    needle: true

  # ============================================
  # AGGRESSIVITET KONTROLLER
  # ============================================
  - type: vertical-stack
    cards:
      - type: custom:mushroom-title-card
        title: Aggressivitet
        subtitle: Justera hur systemet reagerar på priser

      - type: horizontal-stack
        cards:
          # Heat Aggressiveness
          - type: custom:mushroom-number-card
            entity: input_number.svotc_heat_aggressiveness
            icon: mdi:fire
            name: Värme
            display_mode: buttons
            fill_container: false

          # Brake Aggressiveness
          - type: custom:mushroom-number-card
            entity: input_number.svotc_brake_aggressiveness
            icon: mdi:snowflake
            name: Broms
            display_mode: buttons
            fill_container: false

  # ============================================
  # TEMPERATUR INSTÄLLNINGAR
  # ============================================
  - type: vertical-stack
    cards:
      - type: custom:mushroom-title-card
        title: Temperaturinställningar
        
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-number-card
            entity: input_number.svotc_comfort_temperature
            icon: mdi:sofa
            name: Komfort
            display_mode: slider
            
          - type: custom:mushroom-number-card
            entity: input_number.svotc_vacation_temperature
            icon: mdi:palm-tree
            name: Semester
            display_mode: slider

  # ============================================
  # AVANCERADE INSTÄLLNINGAR (Collapsible)
  # ============================================
  - type: custom:fold-entity-row
    head:
      type: section
      label: Avancerade inställningar
    entities:
      - entity: input_number.svotc_max_delta_per_step_c
        name: Max förändring per steg
        icon: mdi:speedometer
        
      - entity: input_number.svotc_comfort_guard_deadband_c
        name: Comfort guard deadband
        icon: mdi:shield-check
        
      - entity: input_number.svotc_price_dwell_minutes
        name: Pris dwell-tid
        icon: mdi:timer-sand
        
      - entity: input_number.svotc_max_total_offset_c
        name: Max total offset
        icon: mdi:shield-alert
        
      - entity: input_number.svotc_min_phase_duration_minutes
        name: Min fas-duration
        icon: mdi:clock-fast

  # ============================================
  # PRICE CHART - Visuell prisgraf
  # ============================================
  - type: custom:apexcharts-card
    header:
      show: true
      title: Elpriser idag & imorgon
      show_states: true
      colorize_states: true
    now:
      show: true
      color: red
      label: Nu
    graph_span: 48h
    span:
      start: day
    yaxis:
      - id: price
        decimals: 2
        apex_config:
          tickAmount: 4
    series:
      - entity: sensor.nordpool_tibber
        name: Elpris
        type: column
        data_generator: |
          return (entity.attributes.raw_today || []).map((entry) => {
            return [new Date(entry.start), entry.value];
          }).concat((entity.attributes.raw_tomorrow || []).map((entry) => {
            return [new Date(entry.start), entry.value];
          }));
        color: |-
          {% set p = states('sensor.svotc_current_price') | float(0) %}
          {% set p30 = states('sensor.svotc_p30') | float(0) %}
          {% set p80 = states('sensor.svotc_p80') | float(0) %}
          {% if p > p80 %} red
          {% elif p < p30 %} green
          {% else %} orange
          {% endif %}
          
      # P30 Line
      - entity: sensor.svotc_p30
        name: P30 (billigt)
        type: line
        stroke_width: 2
        color: green
        extend_to: end
        
      # P80 Line
      - entity: sensor.svotc_p80
        name: P80 (dyrt)
        type: line
        stroke_width: 2
        color: red
        extend_to: end

  # ============================================
  # PHASE INFORMATION
  # ============================================
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-entity-card
        entity: input_text.svotc_brake_phase
        name: Fas
        icon: mdi:state-machine
        icon_color: |-
          {% set phase = states('input_text.svotc_brake_phase') %}
          {% if phase == 'ramping_up' %} blue
          {% elif phase == 'holding' %} blue
          {% elif phase == 'ramping_down' %} orange
          {% else %} grey
          {% endif %}
          
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_phase_duration_min
        name: Fas-tid
        icon: mdi:timer
        icon_color: grey
        
      - type: custom:mushroom-entity-card
        entity: sensor.svotc_prebrake_strength
        name: Prebrake styrka
        icon: mdi:gauge
        icon_color: blue

  # ============================================
  # SYSTEM STATUS INDICATORS
  # ============================================
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-entity-card
        entity: binary_sensor.svotc_comfort_guard_active
        name: Comfort Guard
        icon: mdi:shield-home
        tap_action:
          action: more-info
          
      - type: custom:mushroom-entity-card
        entity: binary_sensor.svotc_brake_active
        name: Braking
        icon: mdi:snowflake-alert
        tap_action:
          action: more-info
          
      - type: custom:mushroom-entity-card
        entity: binary_sensor.svotc_sensors_healthy
        name: Sensorer
        icon: mdi:check-network
        tap_action:
          action: more-info

  # ============================================
  # HISTORISK GRAF - Temperatur & Offset
  # ============================================
  - type: custom:apexcharts-card
    header:
      show: true
      title: Temperatur & Offset (24h)
    graph_span: 24h
    yaxis:
      - id: temp
        decimals: 1
        apex_config:
          tickAmount: 5
      - id: offset
        opposite: true
        decimals: 1
        apex_config:
          tickAmount: 5
    series:
      - entity: sensor.svotc_src_indoor
        name: Inomhus
        yaxis_id: temp
        stroke_width: 2
        color: red
        
      - entity: sensor.svotc_dynamic_target_temperature
        name: Måltemperatur
        yaxis_id: temp
        stroke_width: 1
        type: line
        color: orange
        curve: stepline
        
      - entity: input_number.svotc_applied_offset_c
        name: Offset
        yaxis_id: offset
        stroke_width: 2
        color: blue
        
      - entity: sensor.svotc_src_outdoor
        name: Utomhus
        yaxis_id: temp
        stroke_width: 1
        color: lightblue
