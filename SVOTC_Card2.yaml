title: SVOTC data
type: sections
cards: []
sections:
  - type: grid
    cards:
      - type: entities
        title: ğŸ”§ Entitetskonfiguration
        state_color: true
        show_header_toggle: false
        entities:
          - entity: input_text.svotc_entity_indoor
            name: Inomhustemperatur-sensor
            icon: mdi:home-thermometer-outline
          - entity: input_text.svotc_entity_outdoor
            name: Utomhustemperatur-sensor
            icon: mdi:thermometer
          - entity: input_text.svotc_entity_price
            name: Prisentitet (Nordpool)
            icon: mdi:currency-usd
          - entity: input_text.svotc_notify_service
      - type: entities
        title: ğŸ“Š Aktuell Status
        state_color: true
        show_header_toggle: false
        entities:
          - type: section
            label: Temperaturer
          - entity: sensor.svotc_src_indoor
            name: Inomhus
            icon: mdi:home-thermometer
          - entity: sensor.svotc_dynamic_target_temperature
            name: MÃ¥ltemperatur
            icon: mdi:target
          - entity: sensor.svotc_src_outdoor
            name: Utomhus (verklig)
            icon: mdi:thermometer
          - entity: sensor.svotc_virtual_outdoor_temperature
            name: Utomhus (virtuell â†’ VP)
            icon: mdi:thermometer-chevron-up
            secondary_info: last-changed
          - type: section
            label: Prisstyrning
          - entity: sensor.svotc_src_current_price
            name: Elpris nu
            icon: mdi:currency-usd
          - entity: sensor.svotc_p30
            name: P30 (billig under)
            icon: mdi:arrow-down-bold-circle
          - entity: sensor.svotc_p80
            name: P80 (dyr Ã¶ver)
            icon: mdi:arrow-up-bold-circle
          - type: divider
          - entity: sensor.svotc_prebrake_strength
            name: FÃ¶rbromsstyrka (0-1)
            icon: mdi:speedometer
      - type: vertical-stack
        cards:
          - type: entities
            title: ğŸ›‘ Brake phase & look-ahead
            show_header_toggle: false
            state_color: true
            entities:
              - entity: sensor.svotc_minutes_to_next_brake_start
                name: Min till dyr period
              - entity: sensor.svotc_prebrake_window_min
                name: Prebrake window (min)
              - entity: sensor.svotc_prebrake_strength
                name: Prebrake strength
  - type: grid
    cards:
      - type: entities
        title: ğŸ›¡ï¸ / â±ï¸ / âš¡ Tuning
        show_header_toggle: false
        entities:
          - entity: input_number.svotc_comfort_guard_activate_below_c
            name: Guard activate Î” (Â°C)
          - entity: input_number.svotc_comfort_guard_deactivate_above_c
            name: Guard deactivate Î” (Â°C)
          - type: divider
          - entity: input_number.svotc_price_dwell_cheap_to_neutral_min
            name: Dwell Cheap â†’ Neutral (min)
          - entity: input_number.svotc_price_dwell_neutral_to_brake_min
            name: Dwell Neutral â†’ Brake (min)
          - entity: input_number.svotc_price_dwell_brake_to_neutral_min
            name: Dwell Brake â†’ Neutral (min)
          - entity: input_number.svotc_price_dwell_neutral_to_cheap_min
            name: Dwell Neutral â†’ Cheap (min)
          - type: divider
          - entity: input_number.svotc_brake_rampup_duration_min
            name: Brake ramp-up (min)
          - entity: input_number.svotc_brake_hold_duration_min
            name: Brake hold (min)
          - entity: input_number.svotc_brake_rampdown_duration_min
            name: Brake ramp-down (min)
          - type: divider
          - entity: input_number.svotc_max_delta_per_step_c
            name: Max Î” per min (Â°C)
          - entity: input_number.svotc_brake_hold_offset_c
            name: Brake hold offset (Â°C)
          - entity: input_number.svotc_prebrake_lead_time_min
            name: FÃ¶rbromsning â€“ starta fÃ¶re (min)
            icon: mdi:timer-sand
          - entity: input_number.svotc_comfort_boost_max_c
            name: Komfortboost â€“ max (Â°C)
            icon: mdi:fire
          - entity: input_number.svotc_brake_hold_duration_min
            name: Hold tid (min)
            icon: mdi:minus-circle
          - type: section
            label: Rate Limiting
          - entity: input_number.svotc_max_delta_per_step_c
            name: Max fÃ¶rÃ¤ndring per minut (Â°C)
            icon: mdi:speedometer
  - type: grid
    cards:
      - type: markdown
        content: >-
          {% set req = states('input_number.svotc_requested_offset_c') |
          float(0) %}

          {% set app = states('input_number.svotc_applied_offset_c') | float(0)
          %}

          {% set price_state = states('input_text.svotc_last_price_state') %}

          {% set raw = states('sensor.svotc_raw_price_state') %}

          {% set phase = states('input_text.svotc_brake_phase') %}

          {% set reason = states('input_text.svotc_reason_code') %}

          {% set win = states('sensor.svotc_prebrake_window_min') | float(0) %}

          {% set pre = states('sensor.svotc_prebrake_strength') | float(0) %}

          {% set p = states('sensor.svotc_current_price') | float(none) %}

          {% set p80 = states('sensor.svotc_p80') | float(none) %}


          ### ğŸ§® Intern berÃ¤kning


          {% set guard_on =
          is_state('binary_sensor.svotc_comfort_guard_active','on') %}

          - `comfort_term` = {% if guard_on %}{{
          -(states('input_number.svotc_heat_aggressiveness') | int(2) * 0.4) |
          round(2) }}{% else %}0{% endif %} (guard {% if guard_on %}aktiv{% else
          %}ej aktiv{% endif %})

          - `price_term`   = {% if guard_on %}0 (blockerad){% else %}{{
          (states('input_number.svotc_brake_hold_offset_c') | float(6) *
          states('input_number.svotc_learned_brake_efficiency') | float(1.0) *
          pre) | round(2) }}{% endif %} (hold_offset Ã— efficiency Ã— prebrake)

          - `requested`    = {{ req | round(2) }}Â°C (summa, clamped)

          - `applied`      = {{ app | round(2) }}Â°C (rate-limited)


          ---


          ### ğŸ“ˆ InlÃ¤rning


          **Learned brake efficiency:** {{
          states('input_number.svotc_learned_brake_efficiency') }} (0.5â€“1.5)  

          **Comfort violations (24h):** {{
          states('input_number.svotc_comfort_violations_24h') }}  

          **Thermal mass factor:** {{
          states('input_number.svotc_thermal_mass_factor') }}


          {% set eff = states('input_number.svotc_learned_brake_efficiency') |
          float(1.0) %}

          {% if eff < 0.9 %}

          ğŸ“‰ Minskat bromsstyrka pga fÃ¶r mÃ¥nga komfortÃ¶vertrÃ¤delser

          {% elif eff > 1.1 %}

          ğŸ“ˆ Ã–kat bromsstyrka (tÃ¥l mer broms)

          {% else %}

          âœ… BalanslÃ¤ge

          {% endif %}


          ---


          ### ğŸ“¦ Raw state data


          - `reason_code`: {{ reason }}

          - `raw_price_state`: {{ raw }}

          - `stable_price_state`: {{ price_state }}

          - `pending_price_state`: {{
          states('input_text.svotc_pending_price_state') }}

          - `brake_phase`: {{ phase }}

          - `prebrake_strength`: {{ (pre * 100) | round(1) }}%

          - `prebrake_window`: {{ win }} min

          - `current_price`: {{ p }} (P80: {{ p80 }})


          ---


          ### â±ï¸ Timestamps


          - Price state changed: {{
          states('input_datetime.svotc_last_price_state_changed') }}

          - Brake phase changed: {{
          states('input_datetime.svotc_brake_phase_changed') }}

          - Engine last run: {{ states('input_datetime.svotc_engine_last_run')
          }}


          ---


          **ğŸ“– Strategi-koder**

          | Kod | Betydelse |

          |-----|-----------|

          | `PRICE_BRAKE` | ğŸ”´ Bromsar vÃ¤rme vid dyr el / prebrake (positiv
          offset) |

          | `COMFORT_GUARD` | ğŸ”¥ Skyddar komfort (negativ offset = mer vÃ¤rme) |

          | `MCP_BLOCKS_BRAKE` | ğŸ›¡ï¸ Komfortskydd stoppar broms |

          | `NEUTRAL` | ğŸŸ¢ Normal drift, ingen justering |

          | `OFF` | âš« System avstÃ¤ngt |

          | `PASS_THROUGH` | ğŸ“Š Ã–vervakningslÃ¤ge |

          | `COMFORT_ONLY` | ğŸ›¡ï¸ Endast komfortskydd |

          | `MISSING_INPUTS_FREEZE` | âš ï¸ Sensorer saknas |

          | `PRICE_DATA_WARMUP_FREEZE` | â³ Prisdata initieras |


          *Uppdaterad: {{ now().strftime('%Y-%m-%d %H:%M:%S') }}*
        title: SVOTC â€“ DEBUG (Teknisk data)
badges:
  - type: entity
    entity: person.johan
    show_entity_picture: true
  - type: custom:mushroom-template-badge
    content: Laddbox
    icon: mdi:ev-plug-type2
    color: green
    tap_action:
      action: navigate
      navigation_path: /lovelace/laddbox
  - type: entity
    show_name: false
    show_state: true
    show_icon: true
    tap_action:
      action: navigate
      navigation_path: /dashboard-data/7
    entity: sensor.elpris_spot_avgifter
  - type: custom:mushroom-template-badge
    icon: mdi:mushroom
    color: red
    content: Jul
    tap_action:
      action: navigate
      navigation_path: /lovelace/jul
  - type: custom:mushroom-template-badge
    content: Tariff
    icon: mdi:power-plug
    color: blue
    tap_action:
      action: navigate
      navigation_path: /lovelace/9
  - type: custom:mushroom-template-badge
    content: System
    icon: mdi:server
    color: green
    tap_action:
      action: navigate
      navigation_path: /lovelace/system
max_columns: 4
